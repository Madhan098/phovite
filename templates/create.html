{% extends "base.html" %}

{% block title %}Create PhoVite{% endblock %}

{% block content %}
<section class="pt-20 md:pt-24 pb-12 md:pb-20 px-4 md:px-6" id="generator">
    <div class="container mx-auto max-w-5xl">

        <!-- Input Form -->
        <div id="inputForm" class="glass rounded-2xl md:rounded-3xl p-6 md:p-12 shadow-2xl border border-white/10">

            <h2 class="text-2xl md:text-3xl font-bold mb-6 md:mb-8 text-center text-white">Design Your PhoVite</h2>

            <!-- Family Name Input -->
            <div class="mb-6 md:mb-8">
                <label class="block text-xs md:text-sm font-semibold text-gray-300 mb-2 md:mb-3 uppercase tracking-wide">
                    Family Name
                    <span class="text-xs text-red-400 ml-2 normal-case font-medium">* Required</span>
                </label>
                <input type="text" id="familyName" placeholder="e.g., The Madhan Family" required
                    class="w-full glass-input rounded-xl px-4 md:px-5 py-3 md:py-4 text-sm md:text-base text-white placeholder-gray-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition outline-none bg-slate-800/50">
            </div>

            <!-- Celebrant Name Input -->
            <div class="mb-6 md:mb-8">
                <label class="block text-xs md:text-sm font-semibold text-gray-300 mb-2 md:mb-3 uppercase tracking-wide">
                    Name of Person/Celebrant
                    <span class="text-xs text-red-400 ml-2 normal-case font-medium">* Required</span>
                </label>
                <input type="text" id="celebrantName" placeholder="e.g., Madhan" required
                    class="w-full glass-input rounded-xl px-4 md:px-5 py-3 md:py-4 text-sm md:text-base text-white placeholder-gray-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition outline-none bg-slate-800/50">
            </div>

            <!-- Event Type Selector (Buttons) -->
            <div class="mb-6 md:mb-8">
                <label
                    class="block text-xs md:text-sm font-semibold text-gray-300 mb-3 md:mb-4 uppercase tracking-wide">Event
                    Type</label>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3 md:gap-4" id="eventTypeSelector">

                    <button type="button" class="event-type-btn selected" data-event="Birthday">
                        <div
                            class="glass-card rounded-xl p-4 md:p-5 border-2 border-white/20 hover:border-brand-400/50 transition-all duration-300 text-center touch-manipulation">
                            <div class="text-3xl md:text-4xl mb-2">üéÇ</div>
                            <span class="text-xs md:text-sm font-semibold text-white">Birthday</span>
                        </div>
                    </button>

                    <button type="button" class="event-type-btn" data-event="Wedding">
                        <div
                            class="glass-card rounded-xl p-4 md:p-5 border-2 border-white/20 hover:border-brand-400/50 transition-all duration-300 text-center touch-manipulation">
                            <div class="text-3xl md:text-4xl mb-2">üíç</div>
                            <span class="text-xs md:text-sm font-semibold text-white">Wedding</span>
                        </div>
                    </button>

                    <button type="button" class="event-type-btn" data-event="Party">
                        <div
                            class="glass-card rounded-xl p-4 md:p-5 border-2 border-white/20 hover:border-brand-400/50 transition-all duration-300 text-center touch-manipulation">
                            <div class="text-3xl md:text-4xl mb-2">üéâ</div>
                            <span class="text-xs md:text-sm font-semibold text-white">Party</span>
                        </div>
                    </button>

                    <button type="button" class="event-type-btn" data-event="Corporate">
                        <div
                            class="glass-card rounded-xl p-4 md:p-5 border-2 border-white/20 hover:border-brand-400/50 transition-all duration-300 text-center touch-manipulation">
                            <div class="text-3xl md:text-4xl mb-2">üíº</div>
                            <span class="text-xs md:text-sm font-semibold text-white">Corporate</span>
                        </div>
                    </button>

                    <button type="button" class="event-type-btn" data-event="Anniversary">
                        <div
                            class="glass-card rounded-xl p-4 md:p-5 border-2 border-white/20 hover:border-brand-400/50 transition-all duration-300 text-center touch-manipulation">
                            <div class="text-3xl md:text-4xl mb-2">üíù</div>
                            <span class="text-xs md:text-sm font-semibold text-white">Anniversary</span>
                        </div>
                    </button>

                    <button type="button" class="event-type-btn" data-event="Baby Shower">
                        <div
                            class="glass-card rounded-xl p-4 md:p-5 border-2 border-white/20 hover:border-brand-400/50 transition-all duration-300 text-center touch-manipulation">
                            <div class="text-3xl md:text-4xl mb-2">üë∂</div>
                            <span class="text-xs md:text-sm font-semibold text-white">Baby Shower</span>
                        </div>
                    </button>

                </div>
            </div>

            <!-- Theme Selector -->
            <div class="mb-6 md:mb-8">
                <label
                    class="block text-xs md:text-sm font-semibold text-gray-300 mb-3 md:mb-4 uppercase tracking-wide">Choose
                    Your Theme</label>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4" id="vibeSelector">
                    <!-- Themes will be dynamically inserted here by JavaScript -->
                </div>
            </div>

            <!-- Event Details -->
            <div class="mb-6 md:mb-8">
                <label class="block text-xs md:text-sm font-semibold text-gray-300 mb-3 md:mb-4 uppercase tracking-wide">
                    Event Details
                </label>
                <div class="space-y-4">
                    <!-- Date -->
                    <div>
                        <label class="block text-xs font-semibold text-gray-400 mb-2">Event Date
                            <span class="text-red-400">*</span>
                        </label>
                        <input type="text" id="eventDate" placeholder="e.g., November 25, 2025" required
                            class="w-full glass-input rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition outline-none bg-slate-800/50">
                    </div>

                    <!-- Time -->
                    <div>
                        <label class="block text-xs font-semibold text-gray-400 mb-2">Event Time
                            <span class="text-red-400">*</span>
                        </label>
                        <input type="text" id="eventTime" placeholder="e.g., 7:00 PM" required
                            class="w-full glass-input rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition outline-none bg-slate-800/50">
                    </div>

                    <!-- Venue -->
                    <div>
                        <label class="block text-xs font-semibold text-gray-400 mb-2">Venue/Location
                            <span class="text-red-400">*</span>
                        </label>
                        <input type="text" id="eventVenue" placeholder="e.g., PMR Kalyana Mandapam, Venkatagiri" required
                            class="w-full glass-input rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition outline-none bg-slate-800/50">
                    </div>

                    <!-- Message -->
                    <div>
                        <label class="block text-xs font-semibold text-gray-400 mb-2">Invitation Message
                            <span class="text-gray-500">(Optional)</span>
                        </label>
                        <textarea id="eventMessage" rows="3" placeholder="e.g., Join us for a night of celebration, laughter, and memories!"
                            class="w-full glass-input rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition resize-none outline-none bg-slate-800/50"></textarea>
                    </div>
                </div>
            </div>

            <!-- Photo Upload -->
            <div class="mb-8 md:mb-10">
                <label class="block text-xs md:text-sm font-semibold text-gray-300 mb-2 md:mb-3 uppercase tracking-wide">
                    Upload Your Photo
                    <span class="text-xs text-red-400 ml-2 normal-case font-medium">* Required</span>
                </label>
                <p class="text-xs text-gray-400 mb-3">This photo will appear at the top of your invitation</p>
                <div class="p-1 glass-input rounded-xl">
                    <input type="hidden" role="uploadcare-uploader" data-public-key="demopublickey" data-tabs="file url"
                        data-images-only="true" data-validators="sizeLimit" id="uploadcareInput" />
                </div>
            </div>

            <!-- Generate Button -->
            <button id="generateBtn"
                class="w-full bg-gradient-to-r from-purple-600 via-pink-600 to-purple-600 hover:from-purple-500 hover:via-pink-500 hover:to-purple-500 text-white font-bold py-5 md:py-6 rounded-2xl transition-all duration-300 transform hover:scale-[1.02] shadow-2xl shadow-purple-500/40 text-base md:text-lg flex items-center justify-center gap-3 touch-manipulation">
                <i data-lucide="sparkles" class="w-5 h-5 md:w-6 md:h-6"></i>
                Generate Phovite
            </button>

        </div>

        <!-- RESULT SECTION -->
        <div id="resultSection" class="mt-8 md:mt-12 hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                <!-- Preview Column -->
                <div class="lg:col-span-2">
                    <div
                        class="glass rounded-2xl md:rounded-3xl border border-white/10 shadow-2xl overflow-hidden relative group">

                        <!-- Live Editor Controls (Visible on Hover/Edit) -->
                        <div id="liveEditorControls"
                            class="absolute top-4 right-4 z-30 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity items-end">
                            <button onclick="toggleEditMode()"
                                class="glass-button bg-black/50 hover:bg-black/70 text-white p-2 rounded-lg text-xs flex items-center gap-1">
                                <i data-lucide="edit-3" class="w-4 h-4"></i> Edit Text
                            </button>

                            <!-- Font & Color Controls (Hidden by default, shown in edit mode) -->
                            <div id="styleControls" class="hidden flex-col gap-2">
                                <div class="glass p-2 rounded-lg flex gap-1">
                                    <button onclick="changeFont('font-display')" class="p-1 hover:bg-white/10 rounded"
                                        title="Modern"><span class="font-display">Aa</span></button>
                                    <button onclick="changeFont('font-serif')"
                                        class="p-1 hover:bg-white/10 rounded font-serif" title="Classic">Aa</button>
                                    <button onclick="changeFont('font-mono')"
                                        class="p-1 hover:bg-white/10 rounded font-mono" title="Minimal">Aa</button>
                                </div>
                                <div class="glass p-2 rounded-lg flex gap-1">
                                    <button onclick="changeColor('text-white')"
                                        class="w-6 h-6 rounded-full bg-white border border-gray-400"
                                        title="White"></button>
                                    <button onclick="changeColor('text-black')"
                                        class="w-6 h-6 rounded-full bg-black border border-white"
                                        title="Black"></button>
                                    <button onclick="changeColor('text-yellow-400')"
                                        class="w-6 h-6 rounded-full bg-yellow-400 border border-white"
                                        title="Gold"></button>
                                </div>
                            </div>
                        </div>

                        <div class="relative w-full" style="aspect-ratio: 9/16;">
                            <div id="skeletonLoader" class="absolute inset-0 bg-slate-800/50 skeleton backdrop-blur-sm">
                            </div>
                            <img id="generatedImage" class="absolute inset-0 w-full h-full object-cover"
                                style="display: none;" alt="Generated invitation" />

                            <div class="absolute inset-0 flex flex-col justify-center items-center p-4 md:p-8 lg:p-12 text-center z-10 bg-gradient-to-b from-black/30 via-black/50 to-black/70 backdrop-blur-sm transition-all"
                                id="textOverlay">

                                <!-- Family Name at Top -->
                                <div id="familyNameContainer" class="mb-6">
                                    <p id="familyNameText" class="text-xl md:text-3xl font-display font-bold text-purple-300 drop-shadow-2xl tracking-wide">
                                    </p>
                                </div>

                                <!-- User Photo -->
                                <div id="userPhotoContainer" class="hidden mb-6">
                                    <div class="w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-purple-400/80 overflow-hidden shadow-2xl mx-auto ring-4 ring-purple-500/30">
                                        <img id="userPhotoOverlay" src="" alt="User Photo"
                                            class="w-full h-full object-cover">
                                    </div>
                                </div>

                                <!-- Celebrant Name -->
                                <h3 id="cardTitle" contenteditable="false"
                                    class="text-4xl md:text-6xl lg:text-7xl font-display font-bold mb-4 text-white drop-shadow-2xl outline-none border-2 border-transparent focus:border-white/50 rounded p-2">
                                </h3>

                                <!-- Event Details -->
                                <div id="eventDetailsContainer" class="space-y-3 mb-4">
                                    <!-- Date -->
                                    <div class="flex items-center justify-center gap-2">
                                        <i data-lucide="calendar" class="w-5 h-5 text-pink-400"></i>
                                        <p id="dateText" class="text-lg md:text-2xl text-white font-semibold drop-shadow-lg"></p>
                                    </div>
                                    <!-- Time -->
                                    <div class="flex items-center justify-center gap-2">
                                        <i data-lucide="clock" class="w-5 h-5 text-blue-400"></i>
                                        <p id="timeText" class="text-lg md:text-2xl text-white font-semibold drop-shadow-lg"></p>
                                    </div>
                                    <!-- Venue -->
                                    <div class="flex items-center justify-center gap-2">
                                        <i data-lucide="map-pin" class="w-5 h-5 text-green-400"></i>
                                        <p id="venueText" class="text-lg md:text-2xl text-white font-semibold drop-shadow-lg"></p>
                                    </div>
                                </div>

                                <!-- Message -->
                                <p id="cardBody" contenteditable="false"
                                    class="text-sm md:text-lg lg:text-xl text-gray-100 max-w-lg mx-auto drop-shadow-2xl leading-relaxed px-2 outline-none border-2 border-transparent focus:border-white/50 rounded p-2">
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhancement Controls Column -->
                <div class="lg:col-span-1 space-y-6">

                    <!-- Action Buttons -->
                    <div class="glass rounded-2xl p-6 border border-white/10 space-y-3">
                        <h3 class="text-white font-bold mb-4 flex items-center gap-2">
                            <i data-lucide="share-2" class="w-5 h-5 text-brand-400"></i> Actions
                        </h3>

                        <a id="publicLinkBtn" href="#" target="_blank"
                            class="w-full glass-button bg-brand-500/20 hover:bg-brand-500/30 border-2 border-brand-500/50 hover:border-brand-400 text-white font-semibold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                            <i data-lucide="external-link" class="w-4 h-4"></i>
                            View & Share Page
                        </a>

                        <!-- Download Button Removed as per request -->

                        <button id="generateVideoBtn"
                            class="w-full glass-button bg-purple-500/20 hover:bg-purple-500/30 border-2 border-purple-500/50 hover:border-purple-400 text-white font-semibold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                            <i data-lucide="video" class="w-4 h-4"></i>
                            Generate Hype Video (5-10s)
                        </button>

                        <!-- Video Download Button (Hidden initially) -->
                        <a id="downloadVideoBtn" href="#" download class="hidden w-full glass-button bg-green-500/20 hover:bg-green-500/30 border-2 border-green-500/50 hover:border-green-400 text-white font-semibold py-3 rounded-xl transition-all flex items-center justify-center gap-2">
                            <i data-lucide="download" class="w-4 h-4"></i>
                            Download Video
                        </a>
                    </div>

                    <!-- Enhancements -->
                    <div class="glass rounded-2xl p-6 border border-white/10 space-y-4">
                        <h3 class="text-white font-bold mb-2 flex items-center gap-2">
                            <i data-lucide="sparkles" class="w-5 h-5 text-yellow-400"></i> Enhancements
                        </h3>

                        <!-- Voice -->
                        <div>
                            <label class="block text-xs font-semibold text-gray-400 mb-2">ADD VOICE MESSAGE</label>
                            <button
                                class="w-full glass-input p-3 rounded-lg text-center text-sm text-red-400 hover:bg-red-500/10 transition border border-red-500/30">
                                <i data-lucide="mic" class="w-4 h-4 inline mr-2"></i> Record Message
                            </button>
                        </div>
                    </div>

                    <button id="regenerateBtn"
                        class="w-full text-gray-400 hover:text-white text-sm flex items-center justify-center gap-2 py-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Start Over
                    </button>

                </div>
            </div>
        </div>

    </div>
</section>

<!-- Music Selection Modal -->
<div id="musicModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
    <div class="glass-enhanced rounded-3xl max-w-2xl w-full p-6 md:p-8 border border-purple-500/30 shadow-2xl shadow-purple-500/20 animate-scale-in max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                <i data-lucide="music" class="w-6 h-6 text-purple-400"></i>
                Choose Your Music
            </h3>
            <button onclick="closeMusicModal()" class="text-gray-400 hover:text-white transition">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
        </div>
        
        <p class="text-gray-400 text-sm mb-6">Select a background music for your video or continue without music</p>
        
        <!-- Continue Without Music -->
        <button onclick="generateVideoWithMusic(null)" 
            class="w-full mb-4 px-6 py-4 bg-slate-800 hover:bg-slate-700 border border-slate-600 hover:border-purple-500 text-white font-semibold rounded-xl transition-all duration-300 flex items-center justify-center gap-2">
            <i data-lucide="volume-x" class="w-5 h-5"></i>
            Continue Without Music
        </button>

        <div class="border-t border-white/10 my-6"></div>

        <h4 class="text-white font-semibold mb-4">Background Music Options:</h4>

        <!-- Music Options -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <!-- Birthday Music -->
            <button onclick="generateVideoWithMusic('happy_birthday')" 
                class="music-option p-4 bg-gradient-to-br from-pink-500/10 to-purple-500/10 hover:from-pink-500/20 hover:to-purple-500/20 border border-pink-500/30 hover:border-pink-500/50 rounded-xl transition-all duration-300 text-left group">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-pink-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i data-lucide="cake" class="w-6 h-6 text-pink-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Happy Birthday</p>
                        <p class="text-xs text-gray-400">Upbeat & Cheerful</p>
                    </div>
                </div>
            </button>

            <!-- Wedding Music -->
            <button onclick="generateVideoWithMusic('wedding_bells')" 
                class="music-option p-4 bg-gradient-to-br from-purple-500/10 to-pink-500/10 hover:from-purple-500/20 hover:to-pink-500/20 border border-purple-500/30 hover:border-purple-500/50 rounded-xl transition-all duration-300 text-left group">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-purple-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i data-lucide="heart" class="w-6 h-6 text-purple-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Wedding Bells</p>
                        <p class="text-xs text-gray-400">Romantic & Elegant</p>
                    </div>
                </div>
            </button>

            <!-- Party Music -->
            <button onclick="generateVideoWithMusic('party_time')" 
                class="music-option p-4 bg-gradient-to-br from-blue-500/10 to-cyan-500/10 hover:from-blue-500/20 hover:to-cyan-500/20 border border-blue-500/30 hover:border-blue-500/50 rounded-xl transition-all duration-300 text-left group">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i data-lucide="music-2" class="w-6 h-6 text-blue-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Party Time</p>
                        <p class="text-xs text-gray-400">Energetic & Fun</p>
                    </div>
                </div>
            </button>

            <!-- Celebration Music -->
            <button onclick="generateVideoWithMusic('celebration')" 
                class="music-option p-4 bg-gradient-to-br from-yellow-500/10 to-orange-500/10 hover:from-yellow-500/20 hover:to-orange-500/20 border border-yellow-500/30 hover:border-yellow-500/50 rounded-xl transition-all duration-300 text-left group">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-yellow-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i data-lucide="sparkles" class="w-6 h-6 text-yellow-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Celebration</p>
                        <p class="text-xs text-gray-400">Joyful & Festive</p>
                    </div>
                </div>
            </button>

            <!-- Elegant Music -->
            <button onclick="generateVideoWithMusic('elegant_classic')" 
                class="music-option p-4 bg-gradient-to-br from-indigo-500/10 to-violet-500/10 hover:from-indigo-500/20 hover:to-violet-500/20 border border-indigo-500/30 hover:border-indigo-500/50 rounded-xl transition-all duration-300 text-left group">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-indigo-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i data-lucide="award" class="w-6 h-6 text-indigo-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Elegant Classic</p>
                        <p class="text-xs text-gray-400">Sophisticated & Classy</p>
                    </div>
                </div>
            </button>

            <!-- Upbeat Music -->
            <button onclick="generateVideoWithMusic('upbeat_pop')" 
                class="music-option p-4 bg-gradient-to-br from-green-500/10 to-teal-500/10 hover:from-green-500/20 hover:to-teal-500/20 border border-green-500/30 hover:border-green-500/50 rounded-xl transition-all duration-300 text-left group">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center group-hover:scale-110 transition">
                        <i data-lucide="trending-up" class="w-6 h-6 text-green-400"></i>
                    </div>
                    <div>
                        <p class="text-white font-semibold">Upbeat Pop</p>
                        <p class="text-xs text-gray-400">Modern & Catchy</p>
                    </div>
                </div>
            </button>
        </div>

        <p class="text-xs text-gray-500 mt-6 text-center">Music will be added to your 5-10 second video</p>
    </div>
</div>

<script src="/static/js/script-enhanced.js"></script>

<style>
.spinner {
    display: inline-block;
    width: 1em;
    height: 1em;
    border: 2px solid currentColor;
    border-right-color: transparent;
    border-radius: 50%;
    animation: spinner-rotate 0.75s linear infinite;
}

@keyframes spinner-rotate {
    to { transform: rotate(360deg); }
}
</style>

{% endblock %}